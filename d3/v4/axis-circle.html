<!DOCTYPE html>
<html>
<head>
	<title>axis</title>
	<script type="text/javascript" src="./d3.v4.js"></script>
	<style type="text/css">
		.demo-div{
			width: 960px;
			height: 600px;
		}
		text{
			fill: #fff;
		}
		.gauage-title{
			font-size: 60px;
		}
	</style>
</head>
<body>

<!-- <div class="demo-div" id="demo1">
	
</div> -->
<svg width="960" height="600"></svg>
<script type="text/javascript">
	// var svg = d3.select('#demo1').append("svg").attr("width", 500).attr("height", 900),
	var times = [20111001, 20111002, 20111003, 20111004, 20111005, 20111006];
	var datum = {
		key: 'finish-rate',
		name: '完成率',
		value: 38.56,
		unit: '%',
		legend: [
			{
				key: '',
				name: '趋降',
				range: [0, 20],
				color: '#5F8EB8',
			},
			{
				key: '',
				name: '过冷',
				range: [20, 80],
				color: '#74CEC5',
			},
			{
				key: '',
				name: '稳定',
				range: [80, 100],
				color: '#D78266',
			},
		],
	};

	var svg = d3.select("svg"),
	    margin = {top: 20, right: 80, bottom: 30, left: 50},
	    width = svg.attr("width") - margin.left - margin.right,
	    height = svg.attr("height") - margin.top - margin.bottom,
			bgRadius = 300,
			axisRadius = bgRadius - 40,
			outerRadius = axisRadius,
			innerRadius = 0.6 * axisRadius,
			scaleRadian = d3.scaleLinear().range([-Math.PI, Math.PI]).domain([0, 100]),
			scaleLine = d3.scaleLinear().range([15, 85]).domain([0, 100]),
			arc = d3.arc().outerRadius(outerRadius).innerRadius(innerRadius),
			arcLine= d3.arc().outerRadius(outerRadius).innerRadius(0),
			gaugeGroup = svg.append("g").attr("class", "gauge-group").attr("transform", `translate(${bgRadius},${bgRadius})`);
			// 圆心为圆点， 绘制背景
			gaugeGroup.append("circle").attr("r", bgRadius).attr("fill", "#515151");
			var bg = gaugeGroup.append("g").attr("class", "gauge-backgroup")
			var bgDatum = [{range: [0, 100],
				color: '#D78266'}];
			// 排序
			datum.legend.forEach((d) => {
				bgDatum.push({range: d.range, color: d.color});
			})
			bg.selectAll('.arc').data(bgDatum).enter().append("path").attr("class", "arc")
			.attr("fill", (d) => d.color)
			.attr("d", (d) => {
				var tmpRange = d.range.map((i) => scaleLine(i));
				return  arc({
						startAngle : scaleRadian(tmpRange[0]),
						endAngle : scaleRadian(tmpRange[1])
					});
			});

			// 刻度
			var axisGroup = gaugeGroup.append("g").attr("class", "axis-c");
			// 弧长
			var arcLen = 2 *　Math.PI * axisRadius * (85-15) / 100,
			stepVal = scaleLine(10);
			var toDot = (per) => {
				var x = Math.cos(scaleRadian(per) - 0.5 * Math.PI) * axisRadius;
				var y = Math.sin(scaleRadian(per) - 0.5 * Math.PI) * axisRadius;
				return `${x},${y}`;
			}
			for(var indexFlag=0; indexFlag<=100; indexFlag+=10) {
				// 迭代
				var tickGroup = axisGroup.append("g").attr("class", "tick")
				.attr("opacity", "1")
				.attr("transform", `translate(${toDot(scaleLine(indexFlag))})`)
				// for(var i=0; i<10; i++) {
				// 	tickGroup.append("line").attr("stroke", "red")
				// 	.attr("y2", 0.24 * axisRadius).attr("dx");
				// }
				tickGroup.append("line").attr("stroke", "red")
					.attr("y2", 0.4 * axisRadius);
			 }
			
			axisGroup.append("path").attr("class", "domain")
					.attr("fill", "none")
					.attr("stroke-width", "2px")
					.attr("stroke", '#fff')
					.attr("d", `M ${toDot(15)} A ${axisRadius},${axisRadius} 0 1,1 ${toDot(85)}`);
			gaugeGroup.append('text').attr('class', 'gauage-title')
			.attr('text-anchor', 'middle')
			.attr('dy', 0.7 * axisRadius)
			.text(`${datum.value}${datum.unit}`);
</script>
</body>
</html>